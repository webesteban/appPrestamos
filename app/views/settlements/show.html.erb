<div class="container-fluid">
  <div class="row">
    <!-- Panel izquierdo -->
    <div class="col-md-3">
      <div class="mb-3">
        <input type="text" class="form-control" value="<%= @settlement.collection.name %>" disabled>
        <div class="d-flex mt-2 gap-2">
          <%= button_to "Guardar", settlement_path(@settlement), method: :put, params: { settlement: {} }, class: "btn btn-primary btn-sm" %>
          <%= link_to "Gastos", "#", class: "btn btn-danger btn-sm disabled" %>
          <button class="btn btn-outline-secondary btn-sm" onclick="window.print()"><i class="bi bi-printer"></i></button>
        </div>
      </div>

      <div class="card p-2">
        <h6>Reportes</h6>
        <div class="d-grid gap-2">
          <%= link_to "Ver compras", loans_reports_path(level: "collection", hierarchy_id: @settlement.collection_id), class: "btn btn-dark", data: { turbo: false } %>
          <%= link_to "Ver abonos",  loans_reports_path(level: "collection", hierarchy_id: @settlement.collection_id), class: "btn btn-primary", data: { turbo: false } %>
          <%= link_to "Liquidaciones", settlements_path(collection_id: @settlement.collection_id), class: "btn btn-info", data: { turbo: false } %>
          <button class="btn btn-secondary" disabled>Liquidaciones2</button>
          <button class="btn btn-danger" disabled>Autorizacion</button>
          <button class="btn btn-dark" disabled>Ultimas compras</button>
          <button class="btn btn-warning" disabled>Faltantes</button>
          <button class="btn btn-warning" disabled>Informes de socios y due√±os</button>
          <button class="btn btn-warning" disabled>Retiros o traslado de clientes</button>
          <button class="btn btn-warning" disabled>Estadisticas semanales</button>
          <button class="btn btn-primary" disabled>Descuentos y refinanciacion</button>
          <button class="btn btn-warning" disabled>Liquidaciones por bodegas</button>
          <button class="btn btn-success" disabled>Morocidad de ruta</button>
          <button class="btn btn-danger" disabled>Grafica liquidacion x mes</button>
          <button class="btn btn-dark" disabled>Verificar compras</button>
          <button class="btn btn-dark" disabled>Verificar abonos</button>
        </div>
      </div>
    </div>

    <!-- Panel central -->
    <div class="col-md-6">
      <div class="card p-3">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="mb-0">LIQUIDAR ‚Äî <%= @settlement.settlement_date %></h5>
          <span class="badge <%= @settlement.closed? ? 'bg-primary' : 'bg-secondary' %>">
            <%= @settlement.status.upcase %>
          </span>
        </div>

        <%= form_with model: @settlement,
                      url: settlement_path(@settlement),
                      method: :put,
                      local: true do |f| %>
          <div class="row g-2 mt-2">
            <div class="col-6">
              <label>BASE</label>
              <%= f.number_field :base_start, step: "0.01", class: "form-control", disabled: true %>
            </div>
            <div class="col-6">
              <label>GASTOS (del sistema)</label>
              <input class="form-control" value="<%= number_to_currency(@settlement.expenses_total) %>" disabled>
            </div>
            <div class="col-6">
              <label>ABONOS</label>
              <input class="form-control" value="<%= number_to_currency(@settlement.payments_total) %>" disabled>
            </div>
            <div class="col-6">
              <label>COMPRAS</label>
              <input class="form-control" value="<%= number_to_currency(@settlement.loans_total) %>" disabled>
            </div>
          </div>
        <% end %>

        <!-- Totales calculados (se refrescan con Turbo) -->
        <div class="mt-3 d-block">
          <turbo-frame id="settlement_totals">
            <%= render "settlements/totals", settlement: @settlement %>
          </turbo-frame>
        </div>

        <div class="mt-3 d-flex gap-2">
          <%= button_to "üîÑ Recalcular", recalculate_settlement_path(@settlement), method: :post, class: "btn btn-outline-info" %>
          <%= button_to "Cerrar liquidaci√≥n", close_settlement_path(@settlement), method: :post, class: "btn btn-primary" %>
        </div>
      </div>
    </div>

    <!-- Panel derecho -->
    <div class="col-md-3">
      <div class="card p-2 mb-3">
        <h6>Movimientos del d√≠a</h6>

        <!-- Retanqueos -->
        <turbo-frame id="topups_frame">
          <%= render "settlement_topups/list", settlement: @settlement %>
        </turbo-frame>

        <!-- Retiros -->
        <turbo-frame id="withdrawals_frame" class="mt-3 d-block">
          <%= render "settlement_withdrawals/list", settlement: @settlement %>
        </turbo-frame>
      </div>
    </div>
  </div>
</div>
